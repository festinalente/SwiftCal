function SwiftCal(){let a=!1,b=[],c=[],d=[],e=[],f,g,h,i,j,k=1,l=!1,m=0,n={indexes:[],values:[]},o={};function p(c,a){!1===e.includes(a)&&(c.style.backgroundColor="#fc3",e.push(a),b[e.length-1]={day:a,humanDate:w(a)})}function q(a,f){var d=e.indexOf(f);if(a.style.backgroundColor="#fff",e.splice(1,d),b.splice(1,d),a.children)for(let c=a.children.length-1;c>=0;c--)a.children[c].remove()}function r(a,c){var g="";if(c.children)for(let d=c.children.length-1;d>=0;d--)c.children[d].remove();if(a&&a.length>0){var f=B(a);b[e.indexOf(c.id)].times=JSON.parse(JSON.stringify(a)),f.forEach(function(b,d){g+=b+" ";var a=document.createElement("p");a.classList.add("calendarTime"),a.style.marginBottom="0px",a.textContent=g,!1===c.classList.contains("filler")&&(c.style.backgroundColor="#fc3",d%2==1?(a.style.borderBottomStyle="solid",c.appendChild(a),g=""):(c.appendChild(a),g=""))})}}function s(){return b.forEach(function(c,a){document.getElementById(c.day).style.backgroundColor="#fff",b.splice(1,a),e.splice(1,a)}),this}function t(e){for(var d=g.dataset.dayofweek,b=document.querySelectorAll("[data-dayofweek='"+d+"']"),a=0;a<b.length;a++){var c=document.getElementById(b[a].id);c!==g&&(q(c,b[a].id),D(b[a].id))}}function u(q){var c=q.target;if(g=c,k++,!c.classList.contains("blocked")){h.querySelector(".makeTimeRuleGlobal")&&(h.querySelector(".makeTimeRuleGlobalClass").textContent=H("Set these times for all ","days"));var r=c.dataset.day,s=c.parentElement.parentElement.dataset.month,t=c.parentElement.parentElement.dataset.year,d=v(t,s,r);if(!0!==a){if(!0===f){if(k%2==0){e.length=0,b.length=0;for(var n=document.getElementsByClassName("dayTime"),m=0;m<n.length;m++)n[m].classList.contains("blocked")||(n[m].style.backgroundColor="white");c.style.backgroundColor="#fc3",p(c,d)}k%2==1&&(p(c,d),function(){for(var j=b[0].day,c=b[1].day,l=h.querySelector("[id='"+j+"']").dataset.dayindex,m=h.querySelector("[id='"+c+"']").dataset.dayindex,d=function(){return l-m>0?[m,l]:[l,m]},k=parseInt(d()[0]),f=parseInt(d()[1]),a=k;a<=f;a++){var g=h.querySelector('[data-dayindex = "'+a+'"]');if(g.classList.contains("blocked")){h.querySelector("[id='"+c+"']").style.backgroundColor="white",e.splice(1,1),b.splice(1,1);break}var i=g.id;p(h.querySelector("[id='"+i+"']"),i),a===f&&(e.push(e.splice(1,1)[0]),b.push(b.splice(1,1)[0]))}}());return}if(!1===e.includes(d)){var o=!!h.querySelector(".timeChooser")&&h.querySelector(".timeChooser").querySelector(".makeTimeRuleGlobal");o&& !0===o.checked&&y(d,null),p(c,d),M(d,null),!0===l&&(i.style.height=h.clientHeight+"px",i.style.width=h.clientWidth+"px",i.style.display="inline",L(j,h))}else if(c.style.backgroundColor="white",e.splice(e.indexOf(d),1),b.splice(e.indexOf(d),1),!0===l)for(;c.children[0];)c.removeChild(c.children[0])}}}function v(a,b,c){return a+"-"+b+"-"+c}function w(b){var a=b.split("-");return a[0]+"-"+(parseInt(a[1])+1)+"-"+a[2]}function x(b,c,d,e,f){var a=document.createElement("p");a.id=c,a.textContent=d,b.appendChild(a),a.title=e,a.classList.add("deleteButton"),a.addEventListener("click",function(a){f(a)})}function y(a){var b=document.getElementById(a).dataset.dayofweek,c=document.querySelectorAll("[data-dayofweek='"+b+"']");c.forEach(function(a,b){!1===a.classList.contains("filler")&&(p(document.getElementById(a.id),a.id),M(a.id),c.length)})}function z(a){h.querySelectorAll(".dayTime").forEach(function(a){"rgb(255, 204, 51)"===a.style.backgroundColor&&0===a.children.length&&a.click()}),n.values%2==1?swiftmoAlert&&swiftmoAlert.setContent("Warning, you're missing an end time for the last time gap you entered.").toggle():0===n.values.length?h.querySelector(".timeChooserModal").style.display="none":A(n.values[n.values.length-1])<A(n.values[n.values.length-2])?swiftmoAlert&&swiftmoAlert.setContent("Warning, you've entered an end time which is before the start time.").toggle():!1===C(n.values)?swiftmoAlert&&swiftmoAlert.setContent("Warning, that time overlaps with other times you've already selected.").toggle():h.querySelector(".timeChooserModal").style.display="none"}function A(b){var a=b.split(":");return 36e5*parseInt(a[0])+6e4*parseInt(a[1])}function B(a){var b=[];return function(a){for(var c=[],b=0;b<a.length;b++)if(c.push(A(a[b])),b===a.length-1)return d(a,c)}(a);function c(a,b){return a-b}function d(f,d){for(var e=JSON.parse(JSON.stringify(d)),g=d.sort(c),a=0;a<e.length;a++){var h=g.indexOf(e[a]);if(b.splice(a,1,f[h]),a===d.length-1)return b}}}function C(f){var a=[];if(f.length%2==0)for(var g=0;g<f.length;g++)a.push(A(f[g]));for(var b=0;b<a.length;b++)if(b>=2&&b%2==0){for(var h=a[b],d=a[b+1],c=0;c<a.length;c++)if(c%2==0&&b!==c){var i=a[c],e=a[c+1];if(e>h&&e<d||h>i&&d<e)return!1;if(h===i&&d===e)return!1;if(d>i&&d<e)return!1;else return!0}}}function D(a){a=a?document.getElementById(a):document.getElementById(b[b.length-1].day);for(let c=a.children.length;c>=0;c--)a.children[c]&&a.children[c].remove()}function E(){var a=h.querySelector(".timeChooser"),c=a.querySelector(".makeTimeRuleGlobal"),b=h.querySelectorAll(".timePickerContainer");b.length>=2?(a.removeChild(b[b.length-1]),n.indexes.length%2==0?(n.indexes.splice(n.indexes.length-2,2),n.values.splice(n.values.length-2,2)):(n.indexes.splice(n.indexes.length-1,1),n.values.splice(n.values.length-1,1)),r(n.values,g)):(a.querySelectorAll("select").forEach(function(a){a.selectedIndex=0}),n.indexes.length%2==0?(n.indexes.splice(n.indexes.length-2,2),n.values.splice(n.values.length-2,2)):(n.indexes.splice(n.indexes.length-1,1),n.values.splice(n.values.length-1,1)),c.checked=!1,r(n.values,g),0===h.querySelector(g.id).children.length&&g.click()),!0===c.checked?y(g.id,m):t(g.id)}function F(){if(2*h.querySelectorAll(".timePickerContainer").length!==n.values.length){swiftmoAlert?swiftmoAlert.setContent("Fill in the current time values before adding another.").toggle():alert("Fill in the current time values before adding another.");return}var a=document.createElement("div");a.classList.add("timePickerContainer"),j.appendChild(a);var b=document.createElement("div");b.textContent="Add time:",b.classList.add("deleteDiv"),a.appendChild(b);var c=m;J("Start",a,c),J("End",a,c),I(a),m++}function G(){var a=document.querySelectorAll(".timePickerContainer");a[a.length-1].scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"})}function H(b,c,a){return a||(a=parseInt(g.dataset.dayofweek)),b+["Sun","Mon","Tues","Wednes","Thurs","Fri","Satur"][a]+c}function I(d){var c=d,a=document.createElement("p"),e=H("Set these times for all ","days");if(0===m){a.textContent=e,a.classList.add("timeSelectP","makeTimeRuleGlobalClass"),a.htmlFor="makeTimeRuleGlobal",c.appendChild(a);var b=document.createElement("input");b.setAttribute("type","checkbox"),b.name="makeTimeRuleGlobal",b.classList.add("makeTimeRuleGlobal"),c.appendChild(b),b.addEventListener("click",function(a){!1===b.checked?t(g.id):y(g.id,m)}),G()}else a.textContent=H("Set these times for all ","days"),G()}function J(b,f,c){var d=document.createElement("div");d.classList.add("timeContainer");var e=document.createElement("p");e.classList.add("timeSelectP"),e.textContent=b+":",d.appendChild(e);var a=document.createElement("div");a.id=b+"-"+c,c&&a.classList.add(c),a.classList.add("hour","times",b),d.appendChild(a),K("hh",24,a.id,a,b,c),K("mm",59,a.id,a,b,c),f.appendChild(d)}function K(b,g,h,i,j,k){o[b]="00";var a=document.createElement("select");a.classList.add(b,h+"-"+b,"timeSelect");var c=0,e=document.createElement("option");for(e.textContent=b,e.value="00",a.appendChild(e);c<=g;){var f=document.createElement("option"),d=c.toString();1===d.length&&(d="0"+c),f.value=d,f.textContent=d,a.appendChild(f),c++}a.addEventListener("click",function(){if(o[b]=a.value,"hh"===b&&(o.mm="00",a.nextSibling.selectedIndex="1"),n.indexes.includes(j+"-"+k)){var c=n.indexes.indexOf(j+"-"+k);n.values[c]=o.hh+":"+o.mm}else n.indexes.push(j+"-"+k),n.values.push(o.hh+":"+o.mm);M(null)}),i.appendChild(a)}function L(a,c){var b=c.getBoundingClientRect(),d=b.x,e=b.y,f=b.width,g=a.getBoundingClientRect(),h=g.width;a.style.top=e+10+"px",a.style.left=d+(f-h)/2+"px"}function M(a){null===a&&(!0===h.querySelector(".makeTimeRuleGlobal").checked?y(g.id):r(n.values,g)),a&&r(n.values,h.querySelector("[id='"+a+"']"))}Date.prototype.addMonths=function(c){var a=new Date(this),b=Math.floor(c/12),d=c-12*b;return b&&a.setFullYear(a.getFullYear()+b),d&&a.setMonth(a.getMonth()+d),a},this.formatDate=function(b){let a=b?new Date(b):new Date,c=a.getDate(),d=a.getMonth()+1,e=a.getFullYear(),f=`${e}-${d}-${c}`;return f},this.collectEndUserSelection=function(){return c},this.setSaveAction=function(a){return saveAction=a,this},this.datesSelected=function(){return b},this.showTimes=function(){return n},this.datesSelectedTracker=function(){return e},this.clearSelection=function(){return s},this.disable=function(){a=!0},this.range=function(a){return f=a,this},this.calendar=function(y,P,p,Q,$,_,G,R,S){let T=function(){let a=function(d){let a=new Uint32Array(10);window.crypto.getRandomValues(a);let c="";for(let b=0;b<a.length;b++)if(c+=a[b],b===a.length-1)return c}(10);if(!document.querySelector("calendar"+a))return a;a()}();function U(e){if(!e)return;let c=Array.from(h.querySelectorAll(".dayTime")).map(a=>a.id),f=e.map(a=>a.day);for(let a=0;a<c.length;a++)if(-1===f.indexOf(c[a])){let b=document.getElementById(c[a]);b.classList.add("widthShape","filler"),b.style.backgroundColor="white",b.title="Closed on this day";let d=document.createElement("p");d.classList.add("calendarTime"),d.textContent="Closed",b.appendChild(d)}}function aa(a){a.addEventListener("click",function(){if(d.includes(a.id))a.style.borderStyle="none",c.splice(d.indexOf(a.id),1),d.splice(d.indexOf(a.id),1);else{a.style.borderStyle="solid",a.style.borderColor="blue";var b=a.children[0].textContent.split(" "),e=1,f=parseInt(b[1])-parseInt(b[0]),g=document.getElementById(a.id).firstChild.nextSibling.textContent;c.push({day:a.id,duration:e,timeGap:g,humanDate:w(a.id)}),d.push(a.id),!0===$&& !0===_&&(ac(a.id,e,f),L("durationChooser",h),document.addEventListener("click",function(a){var b=document.getElementById("durationInput"+T).contains(a.target);b&&ad(),b||a.target!==document.getElementById("durationChooserModal"+T)||(document.getElementById("durationChooserModal"+T).style.display="none",ad())}))}})}function ab(){var b=document.createElement("div");b.classList.add("timeChooserModal"),b.id="durationChooserModal";var a=document.createElement("div");a.classList.add("timeChooser"),a.id="durationChooser",b.appendChild(a),h.appendChild(b);var c=document.createElement("div");c.textContent="Duration:",c.classList.add("deleteDiv"),a.appendChild(c),x(c,"deleteButton","x","close",z);var d=document.createElement("div");d.classList.add("timeContainer");var e=document.createElement("label");e.setAttribute("id","calendarLabel"),e.setAttribute("for","hourSelect"),e.textContent="hours:",d.appendChild(e);var f=document.createElement("input");f.setAttribute("type","number"),f.id="durationInput",f.classList.add("hour"),d.appendChild(f),a.appendChild(d)}function ac(c,a,b){document.getElementById("durationInput"+T).setAttribute("min",a),document.getElementById("durationInput"+T).setAttribute("max",b),document.getElementById("durationInput"+T).value="1",document.getElementById("durationChooserModal"+T).style.height=h.clientHeight+"px",document.getElementById("durationChooserModal"+T).style.width=h.clientWidth+"px",document.getElementById("durationChooserModal"+T).style.display="inline"}function ad(){var a=document.getElementById("durationInput"+T).value;c[c.length-1].duration=a}function V(a,d){if(d){b=d;for(var g=0;g<=d.length-1;g++){var c="[id='"+d[g].day+"']";if(null!==a.querySelector(c)&&(e.push(d[g].day),a.querySelector(c).style.backgroundColor="#fc3",a.querySelector(c).classList.add("available"),!0===$&&(aa(a.querySelector(c)),ab()),!0===l&&r(d[g].times,a.querySelector(c)),!0===f&&null!==a.querySelector(c)&& !1===a.querySelector(c).classList.contains("filler"))){a.querySelector(c).style.backgroundColor="#333",a.querySelector(c).classList.add("blocked"),a.querySelector(c).title="No availability on this day";var h=document.createElement("p");h.classList.add("calendarTime"),h.textContent="Sold out",a.querySelector(c).appendChild(h)}}}}if((h=document.createElement("div")).classList.add("calendar"),f=!!R,"string"==typeof y?document.querySelector(y).appendChild(h):y.appendChild(h),h.id="calendar"+T,!0===Q&&(l=!0,ae=h,(i=document.createElement("div")).classList.add("timeChooserModal"),ae.appendChild(i),(af=document.createElement("div")).classList.add("timeCont"),i.appendChild(af),i.addEventListener("click",function(a){!0===a.target.classList.contains("timeChooserModal")&&z()}),(j=document.createElement("div")).classList.add("timeChooser"),af.appendChild(j),(ag=document.createElement("div")).classList.add("deleteDiv"),x(ag,"addTime","+","add a time",F),x(ag,"removeTime","-","remove last time",E),x(ag,"deleteButton","x","close",z),j.appendChild(ag)),void 0===p&&(p=4),!0===G){var W=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],A=document.createElement("div");A.classList.add("dayblockrow");var H=document.createElement("h4");if(H.textContent="Select days of week to block:",A.appendChild(H),W.forEach(function(b,d){var a=document.createElement("input");a.setAttribute("type","checkbox"),a.classList.add("block"),a.name=b,a.dataset.block=W.indexOf(b),A.appendChild(a);var c=document.createElement("label");c.for=b,c.textContent=b,A.appendChild(c)}),h.appendChild(A),G){var I=document.getElementsByClassName("block");for(let B=0;B<I.length;B++)I[B].addEventListener("click",function(b){var a=document.querySelectorAll("[data-dayofweek='"+b.target.dataset.block+"']");if(b.target.checked)for(B=0;B<a.length;B++)a[B].classList.add("widthShape","filler");else for(B=0;B<a.length;B++)a[B].classList.remove("filler")})}}for(var m=[],C=new Date().getMonth(),X=["January","February","March","April","May","June","July","August","September","October","November","December"],J=0,k=0;k<p;k++){m.push(document.createElement("div")),h.appendChild(m[k]),m[k].style.width="15em",m[k].style.backgroundColor="#f15925",m[k].classList.add("month");var D=document.createElement("div");D.textContent=X[(C+k)%12],D.classList.add("monthName"),m[k].appendChild(D);var Y=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],K=document.createElement("div");K.classList.add("weekrow"),m[k].appendChild(K),Y.forEach(function(b){var a=document.createElement("div");K.appendChild(a),a.textContent=b,a.classList.add("dayName","widthShapeDays")});var g=[],n=document.createElement("div");m[k].appendChild(n),n.classList.add("weekrow");var ae,af,ag,M,N,q=new Date().addMonths(k).getFullYear(),s=(C+k)%12,o=new Date(q,s).getDay(),Z=new Date().getDate(),O=(M=(C+k+1)%12,N=new Date().addMonths(k).getFullYear(),new Date(N,M,0).getDate());m[k].dataset.year=q,m[k].dataset.month=s,m[k].id=s+"-"+q;var t=1,v=0;for(let a=0;a<=41;a++)a<o&&(g.push(document.createElement("div")),g[a].classList.add("widthShape","filler"),n.appendChild(g[a]),g[a].style.backgroundColor="white",v++),0===k&&a>=o&&a<Z+o-1&&(g.push(document.createElement("div")),g[a].classList.add("widthShape","filler"),n.appendChild(g[a]),g[a].style.backgroundColor="white"),a>=o&&a<O+o&&(g.push(document.createElement("div")),g[a].textContent=t,g[a].dataset.day=t,g[a].dataset.dayofweek=v,g[a].dataset.dayindex=J,n.appendChild(g[a]),g[a].classList.add("widthShape","dayTime"),g[a].id=q+"-"+s+"-"+t,g[a].addEventListener("click",u,!1),t++,v++,J++),a>=O+o&&(g.push(document.createElement("div")),g[a].classList.add("widthShape","filler"),n.appendChild(g[a]),g[a].style.backgroundColor="white"),(a+1)%7==0&&(n=document.createElement("div"),m[k].appendChild(n),n.classList.add("weekrow"),v=0);k===p-1&&(V(h,P),U(S))}return this}}
