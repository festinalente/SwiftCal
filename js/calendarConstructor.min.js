function SwiftCal(){let r=!1,M=[],D=[],O=[],F=[],U,o,N,R,t,G,a={},s=1,J=!1,d=0,c={indexes:[],values:[]},u={};function h(e,t){!1===F.includes(t)&&(e.style.backgroundColor="#fc3",F.push(t),M[F.length-1]={day:t,humanDate:Y(t)})}function W(e,n){var t,l,r,a="";if(n.children)for(i=n.children.length-1;0<=i;i--)n.children[i].remove();function o(e,t){return e-t}e&&0<e.length&&(r=[],t=function(e){for(var t=[],n=0;n<e.length;n++)if(t.push(y(e[n])),n===e.length-1)return function(e,t){for(var n=JSON.parse(JSON.stringify(t)),l=t.sort(o),a=0;a<n.length;a++){var d=l.indexOf(n[a]);if(r.splice(a,1,e[d]),a===t.length-1)return r}}(e,t)}(e),l=F.indexOf(n.id),M[l].times=JSON.parse(JSON.stringify(e)),t.forEach(function(e,t){a+=e+" ";e=document.createElement("p");e.classList.add("calendarTime"),e.style.marginBottom="0px",e.textContent=a,!1===n.classList.contains("filler")&&(n.style.backgroundColor="#fc3",a=(t%2==1&&(e.style.borderBottomStyle="solid"),n.appendChild(e),""))}))}function e(){return M.forEach(function(e,t){document.getElementById(e.day).style.backgroundColor="#fff",M.splice(1,t),F.splice(1,t)}),this}function m(){for(var e=o.dataset.dayofweek,t=document.querySelectorAll("[data-dayofweek='"+e+"']"),n=0;n<t.length;n++){var l=document.getElementById(t[n].id);l!==o&&(function(e,t){if(t=F.indexOf(t),e.style.backgroundColor="#fff",F.splice(1,t),M.splice(1,t),e.children)for(i=e.children.length-1;0<=i;i--)e.children[i].remove()}(l,t[n].id),function(e){e=e?document.getElementById(e):document.getElementById(M[M.length-1].day);for(i=e.children.length;0<=i;i--)e.children[i]&&e.children[i].remove()}(t[n].id)),o}}function P(e){var t=e.target;if(o=t,s++,!t.classList.contains("blocked")){N.querySelector(".makeTimeRuleGlobal")&&(N.querySelector(".makeTimeRuleGlobalClass").textContent=g("Set these times for all ","days"));var n=t.dataset.day,l=t.parentElement.parentElement.dataset.month,e=t.parentElement.parentElement.dataset.year,l=e+"-"+l+"-"+n;if(!0!==r)if(!0!==U){if(!1===F.includes(l)){n=G.querySelector(".makeTimeRuleGlobal");n&&!0===n.checked&&f(l),h(t,l),E(l),!0===J&&(R.style.height=N.clientHeight+"px",R.style.width=N.clientWidth+"px",R.style.display="inline",K(G,N))}else if(t.style.backgroundColor="white",F.splice(F.indexOf(l),1),M.splice(F.indexOf(l),1),!0===J)for(;t.children[0];)t.removeChild(t.children[0])}else{if(s%2==0){F.length=0,M.length=0;for(var a=document.getElementsByClassName("dayTime"),d=0;d<a.length;d++)a[d].classList.contains("blocked")||(a[d].style.backgroundColor="white");t.style.backgroundColor="#fc3",h(t,l)}s%2==1&&(h(t,l),function(){function e(){return 0<l-a?[a,l]:[l,a]}for(var t=M[0].day,n=M[1].day,l=N.querySelector("[id='"+t+"']").dataset.dayindex,a=N.querySelector("[id='"+n+"']").dataset.dayindex,t=parseInt(e()[0]),d=parseInt(e()[1]),i=t;i<=d;i++){var r=N.querySelector('[data-dayindex = "'+i+'"]');if(r.classList.contains("blocked")){N.querySelector("[id='"+n+"']").style.backgroundColor="white",F.splice(1,1),M.splice(1,1);break}r=r.id;h(N.querySelector("[id='"+r+"']"),r),i===d&&(F.push(F.splice(1,1)[0]),M.push(M.splice(1,1)[0]))}}())}}}function Y(e){e=e.split("-");return e[0]+"-"+(parseInt(e[1])+1)+"-"+e[2]}function H(e,t,n,l,a){var d=document.createElement("p");d.id=t,d.textContent=n,e.appendChild(d),d.title=l,d.classList.add("deleteButton"),d.addEventListener("click",function(e){a(e)})}function f(e){var n=document.getElementById(e).dataset.dayofweek,l=document.querySelectorAll("[data-dayofweek='"+n+"']");l.forEach(function(e,t){!1===e.classList.contains("filler")&&(h(document.getElementById(e.id),e.id),E(e.id),e=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],a[e[parseInt(n-1)]]=JSON.parse(JSON.stringify(c.values)),l.length)})}function V(e){N.querySelectorAll(".dayTime").forEach(function(e){"rgb(255, 204, 51)"===e.style.backgroundColor&&0===e.children.length&&e.click()}),c.values%2==1?swiftmoAlert&&swiftmoAlert.setContent("Warning, you're missing an end time for the last time gap you entered.").toggle():0===c.values.length?N.querySelector(".timeChooserModal").style.display="none":y(c.values[c.values.length-1])<y(c.values[c.values.length-2])?swiftmoAlert&&swiftmoAlert.setContent("Warning, you've entered an end time which is before the start time.").toggle():!1===function(e){var t=[];if(e.length%2==0)for(var n=0;n<e.length;n++)t.push(y(e[n]));for(var l=0;l<t.length;l++)if(2<=l&&l%2==0)for(var a=t[l],d=t[l+1],i=0;i<t.length;i++)if(i%2==0&&l!==i){var r=t[i],o=t[i+1];return!(a<o&&o<d)&&(!(r<a&&d<o)&&((a!==r||d!==o)&&!(r<d&&d<o)))}}(c.values)?swiftmoAlert&&swiftmoAlert.setContent("Warning, that time overlaps with other times you've already selected.").toggle():N.querySelector(".timeChooserModal").style.display="none"}function y(e){e=e.split(":");return 60*parseInt(e[0])*60*1e3+60*parseInt(e[1])*1e3}function j(){var e=N.querySelector(".timeChooser"),t=e.querySelector(".makeTimeRuleGlobal"),n=N.querySelectorAll(".timePickerContainer");2<=n.length?(e.removeChild(n[n.length-1]),c.indexes.length%2==0?(c.indexes.splice(c.indexes.length-2,2),c.values.splice(c.values.length-2,2)):(c.indexes.splice(c.indexes.length-1,1),c.values.splice(c.values.length-1,1)),W(c.values,o)):(e.querySelectorAll("select").forEach(function(e){e.selectedIndex=0}),c.indexes.length%2==0?(c.indexes.splice(c.indexes.length-2,2),c.values.splice(c.values.length-2,2)):(c.indexes.splice(c.indexes.length-1,1),c.values.splice(c.values.length-1,1)),t.checked=!1,W(c.values,o),0===N.querySelector(o.id).children.length&&o.click()),!0===t.checked?f(o.id,d):m(o.id)}function z(){if(2*N.querySelectorAll(".timePickerContainer").length!==c.values.length)return gthing=N,void(swiftmoAlert?swiftmoAlert.setContent("Fill in the current time values before adding another.").toggle():alert("Fill in the current time values before adding another."));var e=document.createElement("div");e.classList.add("timePickerContainer"),G.appendChild(e);var t=document.createElement("div");t.textContent="Add time:",t.classList.add("deleteDiv"),e.appendChild(t);var n,l=d;C("Start",e,l),C("End",e,l),l=t=e,e=document.createElement("p"),t=g("Set these times for all ","days"),0===d?(e.textContent=t,e.classList.add("timeSelectP","makeTimeRuleGlobalClass"),e.htmlFor="makeTimeRuleGlobal",l.appendChild(e),(n=document.createElement("input")).setAttribute("type","checkbox"),n.name="makeTimeRuleGlobal",n.classList.add("makeTimeRuleGlobal"),l.appendChild(n),n.addEventListener("click",function(e){!1===n.checked?m(o.id):f(o.id,d)})):e.textContent=g("Set these times for all ","days"),v(),d++}function v(){var e=document.querySelectorAll(".timePickerContainer");e[e.length-1].scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"})}function g(e,t,n){return e+["Sun","Mon","Tues","Wednes","Thurs","Fri","Satur"][n=n||parseInt(o.dataset.dayofweek)]+t}function C(e,t,n){var l=document.createElement("div");l.classList.add("timeContainer");var a=document.createElement("p");a.classList.add("timeSelectP"),a.textContent=e+":",l.appendChild(a);a=document.createElement("div");a.id=e+"-"+n,n&&a.classList.add(n),a.classList.add("hour","times",e),l.appendChild(a),S("hh",24,a.id,a,e,n),S("mm",59,a.id,a,e,n),t.appendChild(l)}function S(t,e,n,l,a,d){u[t]="00";var i=document.createElement("select");i.classList.add(t,n+"-"+t,"timeSelect");var r=0,n=document.createElement("option");for(n.textContent=t,n.value="00",i.appendChild(n);r<=e;){var o=document.createElement("option"),s=r.toString();1===s.length&&(s="0"+r),o.value=s,o.textContent=s,i.appendChild(o),r++}i.addEventListener("click",function(){var e;u[t]=i.value,"hh"===t&&(u.mm="00",i.nextSibling.selectedIndex="1"),c.indexes.includes(a+"-"+d)?(e=c.indexes.indexOf(a+"-"+d),c.values[e]=u.hh+":"+u.mm):(c.indexes.push(a+"-"+d),c.values.push(u.hh+":"+u.mm)),E(null)}),l.appendChild(i)}function K(e,t){var n=t.getBoundingClientRect(),l=n.x,t=n.y,n=l+(n.width-e.getBoundingClientRect().width)/2;e.style.top=t+10+"px",e.style.left=n+"px"}function E(e){null===e&&(!0===N.querySelector(".makeTimeRuleGlobal").checked?f(o.id):W(c.values,o)),e&&W(c.values,N.querySelector("[id='"+e+"']"))}function Q(){let e=function(e){var t=new Uint32Array(e);window.crypto.getRandomValues(t);let n="";for(let e=0;e<t.length;e++)if(n+=t[e],e===t.length-1)return n}(10);if(!document.querySelector("calendar"+e))return e;e()}Date.prototype.addMonths=function(e){var t=new Date(this),n=Math.floor(e/12),e=e-12*n;return n&&t.setFullYear(t.getFullYear()+n),e&&t.setMonth(t.getMonth()+e),t},this.collectEndUserSelection=function(){return D},this.setSaveAction=function(e){return t=e,this},this.datesSelected=function(){return M},this.showTimes=function(){return c},this.jsonldFriendlyTimes=function(){return a},this.datesSelectedTracker=function(){return F},this.clearSelection=function(){return e},this.disable=function(){r=!0},this.range=function(e){return U=e,this},this.calendar=function(e,t,n,l,d,a,i){function r(n){n.addEventListener("click",function(){var e,t;O.includes(n.id)?(n.style.borderStyle="none",D.splice(O.indexOf(n.id),1),O.splice(O.indexOf(n.id),1)):(n.style.borderStyle="solid",n.style.borderColor="blue",e=n.children[0].textContent.split(" "),t=parseInt(e[1])-parseInt(e[0]),e=document.getElementById(n.id).firstChild.nextSibling.textContent,D.push({day:n.id,duration:1,timeGap:e,humanDate:Y(n.id)}),O.push(n.id),!0===d&&!0===a&&(n.id,e=1,t=t,document.getElementById("durationInput"+calendarUniqueId).setAttribute("min",e),document.getElementById("durationInput"+calendarUniqueId).setAttribute("max",t),document.getElementById("durationInput"+calendarUniqueId).value="1",document.getElementById("durationChooserModal"+calendarUniqueId).style.height=N.clientHeight+"px",document.getElementById("durationChooserModal"+calendarUniqueId).style.width=N.clientWidth+"px",document.getElementById("durationChooserModal"+calendarUniqueId).style.display="inline",K("durationChooser",N),document.addEventListener("click",function(e){var t=document.getElementById("durationInput"+calendarUniqueId).contains(e.target);t&&o(),t||e.target!==document.getElementById("durationChooserModal"+calendarUniqueId)||(document.getElementById("durationChooserModal"+calendarUniqueId).style.display="none",o())})))})}function o(){var e=document.getElementById("durationInput"+calendarUniqueId).value;D[D.length-1].duration=e}function s(e,t){if(t){M=t;for(var n=0;n<=t.length-1;n++){var l,a="[id='"+t[n].day+"']";null!==e.querySelector(a)&&(F.push(t[n].day),e.querySelector(a).style.backgroundColor="#fc3",e.querySelector(a).classList.add("available"),!0===d&&(r(e.querySelector(a)),function(){var e=document.createElement("div");e.classList.add("timeChooserModal"),e.id="durationChooserModal";var t=document.createElement("div");t.classList.add("timeChooser"),t.id="durationChooser",e.appendChild(t),N.appendChild(e);var n=document.createElement("div");n.textContent="Duration:",n.classList.add("deleteDiv"),t.appendChild(n),H(n,"deleteButton","x","close",V),(e=document.createElement("div")).classList.add("timeContainer"),(n=document.createElement("label")).setAttribute("id","calendarLabel"),n.setAttribute("for","hourSelect"),n.textContent="hours:",e.appendChild(n),(n=document.createElement("input")).setAttribute("type","number"),n.id="durationInput",n.classList.add("hour"),e.appendChild(n),t.appendChild(e)}()),!0===J&&W(t[n].times,e.querySelector(a)),!0===U&&null!==e.querySelector(a)&&!1===e.querySelector(a).classList.contains("filler")&&(e.querySelector(a).style.backgroundColor="#333",e.querySelector(a).classList.add("blocked"),e.querySelector(a).title="No availability on this day",(l=document.createElement("p")).classList.add("calendarTime"),l.textContent="Sold out",e.querySelector(a).appendChild(l)))}}}if(calendarUniqueId=Q(),N=document.createElement("div"),N.classList.add("calendar"),("string"==typeof e?document.querySelector(e):e).appendChild(N),N.id="calendar"+calendarUniqueId,!0===l&&(J=!0,h=N,R=document.createElement("div"),R.classList.add("timeChooserModal"),h.appendChild(R),(h=document.createElement("div")).classList.add("timeCont"),R.appendChild(h),R.addEventListener("click",function(e){!1===e.target.classList.contains("timeChooserModal")||V()}),G=document.createElement("div"),G.classList.add("timeChooser"),h.appendChild(G),(h=document.createElement("div")).classList.add("deleteDiv"),H(h,"addTime","+","add a time",z),H(h,"removeTime","-","remove last time",j),H(h,"deleteButton","x","close",V),G.appendChild(h)),void 0===n&&(n=4),!0===i){var c=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],u=document.createElement("div");u.classList.add("dayblockrow");var h=document.createElement("h4");if(h.textContent="Select days of week to block:",u.appendChild(h),c.forEach(function(e,t){var n=document.createElement("input");n.setAttribute("type","checkbox"),n.classList.add("block"),n.name=e,n.dataset.block=c.indexOf(e),u.appendChild(n);n=document.createElement("label");n.for=e,n.textContent=e,u.appendChild(n)}),N.appendChild(u),i)for(var m=document.getElementsByClassName("block"),f=0;f<m.length;f++)m[f].addEventListener("click",function(e){var t=document.querySelectorAll("[data-dayofweek='"+e.target.dataset.block+"']");if(e.target.checked)for(f=0;f<t.length;f++)t[f].classList.add("widthShape","filler");else for(f=0;f<t.length;f++)t[f].classList.remove("filler")})}for(var y,v=[],i=new Date,g=i.getMonth(),C=(i.getFullYear(),["January","February","March","April","May","June","July","August","September","October","November","December"]),S=0,f=0;f<n;f++){v.push(document.createElement("div")),N.appendChild(v[f]),v[f].style.width="15em",v[f].style.backgroundColor="#f15925",v[f].classList.add("month");var E=document.createElement("div");E.textContent=C[(g+f)%12],E.classList.add("monthName"),v[f].appendChild(E);var k=document.createElement("div");k.classList.add("weekrow"),v[f].appendChild(k),["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].forEach(function(e){var t=document.createElement("div");k.appendChild(t),t.textContent=e,t.classList.add("dayName","widthShapeDays")});var b=[],x=document.createElement("div");v[f].appendChild(x),x.classList.add("weekrow");var w=(new Date).addMonths(f).getFullYear(),L=(g+f)%12,q=new Date(w,L).getDay(),I=(new Date).getDate(),A=(y=(g+f+1)%12,E=(new Date).addMonths(f).getFullYear(),new Date(E,y,0).getDate());v[f].dataset.year=w,v[f].dataset.month=L,v[f].id=L+"-"+w;var T=1,B=0;for(p=0;p<=41;p++)p<q&&(b.push(document.createElement("div")),b[p].classList.add("widthShape","filler"),x.appendChild(b[p]),b[p].style.backgroundColor="white",B++),0===f&&p>=q&&p<I+q-1&&(b.push(document.createElement("div")),b[p].classList.add("widthShape","filler"),x.appendChild(b[p]),b[p].style.backgroundColor="white"),p>=q&&p<A+q&&(b.push(document.createElement("div")),b[p].textContent=T,b[p].dataset.day=T,b[p].dataset.dayofweek=B,b[p].dataset.dayindex=S,x.appendChild(b[p]),b[p].classList.add("widthShape","dayTime"),b[p].id=w+"-"+L+"-"+T,b[p].addEventListener("click",P,!1),T++,B++,S++),p>=A+q&&(b.push(document.createElement("div")),b[p].classList.add("widthShape","filler"),x.appendChild(b[p]),b[p].style.backgroundColor="white"),(p+1)%7==0&&(x=document.createElement("div"),v[f].appendChild(x),x.classList.add("weekrow"),B=0);f===n-1&&s(N,t)}return this}}